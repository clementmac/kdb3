{
    "_id": "_design/testView",
    "views": {
        "names": {
            "setup": [
                "CREATE TABLE IF NOT EXISTS names (name TEXT, doc_id TEXT)"
            ],
            "delete": [
                "DELETE FROM names WHERE doc_id IN (SELECT DISTINCT doc_id FROM docsdb.changes WHERE seq_number > ${begin_seq_number} AND seq_id > ${begin_seq_id} AND seq_number <= ${end_seq_number} AND seq_id <= ${end_seq_id});"
            ],
            "update": [
                "INSERT INTO names (name, doc_id) SELECT * FROM (SELECT json_extract(d.data, '$.name') as name, d.doc_id FROM docsdb.documents d JOIN (SELECT DISTINCT doc_id FROM docsdb.changes WHERE seq_number > ${begin_seq_number} AND seq_id > ${begin_seq_id} AND seq_number <= ${end_seq_number} AND seq_id <= ${end_seq_id}) c USING(doc_id)) WHERE name is not null "
            ],
            "select": {
                "default": "SELECT json_object('name', name, 'age', 32) FROM names"
            }
        }
    },
    "_rev": "11-0e1fd2b5bf54b93956a24734e7f5e4c1"
}